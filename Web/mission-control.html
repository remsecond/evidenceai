<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EvidenceAI Mission Control</title>
    <!-- Previous styles remain unchanged -->
    <style>
        /* Previous styles remain unchanged */
        .output-section {
            margin-top: 20px;
        }

        .output-section h3 {
            color: var(--accent);
            margin-bottom: 10px;
        }

        .output-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .output-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .output-card h4 {
            color: var(--secondary);
            margin-top: 0;
        }

        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .tag {
            background: var(--light);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            color: var(--secondary);
        }

        .file-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .file-list li {
            padding: 5px 0;
            border-bottom: 1px solid var(--light);
        }

        .file-list li:last-child {
            border-bottom: none;
        }

        .preview {
            font-family: monospace;
            background: var(--light);
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- System Status -->
        <div class="card">
            <div class="header">
                <h2>System Status</h2>
                <span class="status running">Running</span>
            </div>
            <div class="metrics">
                <div class="metric">
                    <div class="value">4</div>
                    <div class="label">Active Services</div>
                </div>
                <div class="metric">
                    <div class="value">2</div>
                    <div class="label">Processing</div>
                </div>
                <div class="metric">
                    <div class="value">98%</div>
                    <div class="label">Uptime</div>
                </div>
            </div>
            <div class="controls">
                <button class="danger" onclick="stopSystem()">Stop System</button>
                <button class="success" onclick="startSystem()">Start System</button>
            </div>
        </div>

        <!-- Document Processing -->
        <div class="card">
            <div class="header">
                <h2>Document Processing</h2>
                <span class="status running">Active</span>
            </div>
            <div class="upload-zone" id="upload-zone" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" onclick="triggerUpload()">
                <p>Drop PDF files here or click to upload</p>
                <input type="file" id="file-input" style="display: none" accept=".pdf" onchange="handleFiles(event)">
            </div>
            <div class="progress-bar">
                <div class="fill" id="progress-bar-fill" style="width: 0%"></div>
            </div>
            <div class="metrics">
                <div class="metric">
                    <div class="value" id="processed-count">0</div>
                    <div class="label">Processed</div>
                </div>
                <div class="metric">
                    <div class="value" id="queue-count">0</div>
                    <div class="label">In Queue</div>
                </div>
            </div>
        </div>

        <!-- Analysis Results -->
        <div class="card">
            <div class="header">
                <h2>Analysis Results</h2>
            </div>
            <div id="analysis-results">
                <div class="output-section">
                    <h3>Document Information</h3>
                    <div class="metrics">
                        <div class="metric">
                            <div class="value" id="page-count">-</div>
                            <div class="label">Pages</div>
                        </div>
                        <div class="metric">
                            <div class="value" id="word-count">-</div>
                            <div class="label">Words</div>
                        </div>
                        <div class="metric">
                            <div class="value" id="chunk-count">-</div>
                            <div class="label">Chunks</div>
                        </div>
                    </div>
                </div>

                <div class="output-section">
                    <h3>Content Analysis</h3>
                    <div class="output-grid">
                        <div class="output-card">
                            <h4>Participants</h4>
                            <div class="tag-list" id="participants-list"></div>
                        </div>
                        <div class="output-card">
                            <h4>Topics</h4>
                            <div class="tag-list" id="topics-list"></div>
                        </div>
                    </div>
                </div>

                <div class="output-section">
                    <h3>Generated Files</h3>
                    <div class="output-grid">
                        <div class="output-card">
                            <h4>Raw Outputs</h4>
                            <ul class="file-list" id="raw-files"></ul>
                        </div>
                        <div class="output-card">
                            <h4>NotebookLM</h4>
                            <ul class="file-list" id="notebook-files"></ul>
                        </div>
                        <div class="output-card">
                            <h4>LLM Analysis</h4>
                            <ul class="file-list" id="llm-files"></ul>
                        </div>
                    </div>
                </div>

                <div class="output-section">
                    <h3>Content Preview</h3>
                    <div class="preview" id="content-preview"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // File Upload Handling
        function triggerUpload() {
            document.getElementById('file-input').click();
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('upload-zone').style.borderColor = '#3498db';
        }

        function handleDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('upload-zone').style.borderColor = '';
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function handleFiles(event) {
            const files = event.target.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        async function processFile(file) {
            if (!file.type.includes('pdf')) {
                alert('Please upload a PDF file');
                return;
            }

            // Update UI to processing state
            document.getElementById('progress-bar-fill').style.width = '50%';
            document.getElementById('processed-count').textContent = '...';
            document.getElementById('queue-count').textContent = '1';

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/process', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`Processing failed: ${response.statusText}`);
                }

                const result = await response.json();
                
                if (result.status === 'success') {
                    updateResults(result);
                    document.getElementById('progress-bar-fill').style.width = '100%';
                    document.getElementById('processed-count').textContent = 
                        (parseInt(document.getElementById('processed-count').textContent || '0') + 1).toString();
                    document.getElementById('queue-count').textContent = '0';
                } else {
                    throw new Error(result.message || 'Processing failed');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('progress-bar-fill').style.width = '0%';
                document.getElementById('queue-count').textContent = '0';
                alert(`Error processing file: ${error.message}`);
            }
        }

        function updateResults(result) {
            // Update metrics
            document.getElementById('page-count').textContent = result.result.statistics.pages || '-';
            document.getElementById('word-count').textContent = result.result.statistics.words || '-';
            document.getElementById('chunk-count').textContent = result.result.statistics.chunks || '-';

            // Update participants
            const participantsList = document.getElementById('participants-list');
            participantsList.innerHTML = Array.from(result.result.content.participants || [])
                .map(p => `<span class="tag">${p}</span>`)
                .join('');

            // Update topics
            const topicsList = document.getElementById('topics-list');
            topicsList.innerHTML = Array.from(result.result.content.topics || [])
                .map(t => `<span class="tag">${t}</span>`)
                .join('');

            // Update file lists
            const rawFiles = document.getElementById('raw-files');
            rawFiles.innerHTML = result.result.output_structure.raw.files
                .map(f => `<li>${f}</li>`)
                .join('');

            const notebookFiles = document.getElementById('notebook-files');
            notebookFiles.innerHTML = result.result.output_structure.notebook.files
                .map(f => `<li>${f}</li>`)
                .join('');

            const llmFiles = document.getElementById('llm-files');
            llmFiles.innerHTML = result.result.output_structure.llm.files
                .map(f => `<li>${f}</li>`)
                .join('');

            // Update preview
            document.getElementById('content-preview').textContent = result.result.content.text || '';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Reset UI
            document.getElementById('progress-bar-fill').style.width = '0%';
            document.getElementById('processed-count').textContent = '0';
            document.getElementById('queue-count').textContent = '0';
        });
    </script>
</body>
</html>
